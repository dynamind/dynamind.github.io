<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>scroller</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 40px 0 0 40px;
      overflow: hidden;
    }
    .small-motherfucker,
    .large-motherfucker {
      display: inline-block;
      background: url(colormap.png);
      background-size: cover;
      width: 1000px;
      height: 1000px;
    }
    .top-wrapper {
      overflow: hidden;
      position: absolute;
      top: 10px;
      right: 12px;
      left: 40px;
      z-index: 1;
    }
    .top-content {
      background: url(colormap.png);
      background-size: cover;
      width: 1000px;
      height: 20px;
    }
    .left-wrapper {
      overflow: hidden;
      position: absolute;
      left: 10px;
      top: 40px;
      bottom: 12px;
      z-index: 1;
    }
    .left-content {
      background: url(colormap.png);
      background-size: cover;
      width: 20px;
      height: 1000px;
    }
  </style>
  <style>
    .scroller-wrapper {
      position: relative;
      /* For demo: */
      width: calc(100vw - 50px);
      height: calc(100vh - 50px);
    }
    .scroller {
      width: 100%;
      height: 100%;
      overflow: scroll;
    }
    .scroller-wrapper-inner {
      display: inline-block;
      padding-right: 20px;
      padding-bottom: 16px;
    }    
    .horizontal .scroller {
    }
    .vertical .scroller {
    }

    /* disable scroll bars */
    
    .scroller {
      -ms-overflow-style: none;
    }
    .scroller::-webkit-scrollbar {
      display: none;
    }
    
    /* scroll bar styling */    
    
    .scroll-horizontal {
      display: none;
      position: absolute;
      height: 20px;
      left: 0;
      bottom: 0;
      right: 20px;
      z-index: 3;
      opacity: 1;
      overflow: hidden;
    }
    .scroll-vertical {
      display: none;
      position: absolute;
      width: 20px;
      top: 0;
      right: 0;
      bottom: 20px;
      z-index: 1;
      opacity: 1;
      overflow: hidden;
    }
    .scroll-corner {
      display: none;
      position: absolute;
      width: 20px;
      height: 20px;
      bottom: 0px;
      right: 0px;
      background: #A6A3A2;
      background-color: #666;
/*            border: 1px solid #fff;*/
      z-index: 3;
      opacity: 1;
    }
    
    .horizontal .scroll-horizontal,
    .vertical .scroll-vertical,
    .horizontal .scroll-corner,
    .vertical .scroll-corner {
      display: block;
    }
    
    .scroll-button {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      width: 20px;
      height: 20px;
/*      background: #A6A3A2;*/
      background-color: #666;
/*      border: 1px solid #fff;*/
      z-index: 2;
      background-size: 20px 20px;
/*      background-position: -1px -1px;*/
      cursor: pointer;
    }    
    .scroll-horizontal .scroll-start {
      right: auto;
      background-image: url(left.png);
    }
    .scroll-vertical .scroll-start {
      bottom: auto;
      background-image: url(up.png);
    }
    .scroll-horizontal .scroll-end {
      left: auto;
      background-image: url(right.png);
    }
    .scroll-vertical .scroll-end {
      top: auto;
      background-image: url(down.png);
    }
    
    .scroll-track {
      position: absolute;
      background-color: #555;
/*      border: 1px solid rgba(255,255,255,0.1);*/
    }
    .scroll-vertical .scroll-track {
      bottom: 20px;
      top: 20px;
      left: 0;
      right: 0;
    }
    .scroll-horizontal .scroll-track {
      left: 20px;
      right: 20px;
      top: 0;
      bottom: 0;
    }
    .scroll-vertical .scroll-thumb {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 0px;
    }
    .scroll-horizontal .scroll-thumb {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 0px;
    }
    .scroll-thumb-inner {
      background-color: #888;
      margin: 5px;
      border-radius: 5px;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }
  </style>
</head>
<body>
  
  <div class="top-wrapper"><div class="top-content"></div></div>
  <div class="left-wrapper"><div class="left-content"></div></div>
  
  <div class="large-motherfucker"></div>
  
  <script>
    function scrollify(scrollable) {
      'use strict';
      
      function debounce(func, wait, immediate) {
      	var timeout;
      	return function() {
      		var context = this, args = arguments;
      		var later = function() {
      			timeout = null;
      			if (!immediate) func.apply(context, args);
      		};
      		var callNow = immediate && !timeout;
      		clearTimeout(timeout);
      		timeout = setTimeout(later, wait);
      		if (callNow) func.apply(context, args);
      	};
      }
      
      /**
       * Construct the DOM, attach handlers
       */
      function init() {
                        
        function create(className) {
          var el = document.createElement('div');
          el.className = className;
          return el;
        }
        
        function createScrollBar(className) {
          var thumb = create('scroll-thumb');
          thumb.appendChild(create('scroll-thumb-inner'));
          
          var track = create('scroll-track');
          track.appendChild(thumb);
          
          var scroller = create(className);
          scroller.appendChild(create('scroll-button scroll-start'));
          scroller.appendChild(track);
          scroller.appendChild(create('scroll-button scroll-end'));
          
          return {
            scroller: scroller,
            track: track,
            thumb: thumb
          };
        }
        
        var horizontal = createScrollBar('scroll-horizontal');
        const vertical = createScrollBar('scroll-vertical');

        var scroller = create('scroller'); /* scroller div clips the area */
        var scrollerWrapper = create('scroller-wrapper horizontal vertical'); /* wrapper div serves as relative positioning context */
        scrollerWrapper.appendChild(scroller);
        var innerWrapper = create('scroller-wrapper-inner');
        scroller.appendChild(innerWrapper);
        scrollable.parentNode.insertBefore(scrollerWrapper, scrollable);
        innerWrapper.appendChild(scrollable);

        scrollerWrapper.appendChild(horizontal.scroller);
        scrollerWrapper.appendChild(vertical.scroller);
        scrollerWrapper.appendChild(create('scroll-corner'));

        return {
          wrapper: scrollerWrapper,
          scroller: scroller,
          horizontal: horizontal,
          vertical: vertical
        };
      }
      
      function updateScrollThumbs() {
        var MAGIC_NUMBER = 0;
        var scroller = self.state.scroller;
        
        var horizontal = self.state.horizontal;        
        var maxWidth = horizontal.track.offsetWidth - MAGIC_NUMBER;
        var width = (scroller.offsetWidth / scroller.scrollWidth) * maxWidth;
        if (width > maxWidth) width = maxWidth;
        var left = (maxWidth - width) * scroller.scrollLeft / (scroller.scrollWidth - scroller.offsetWidth);
        horizontal.thumb.style.width = (width - MAGIC_NUMBER) + 'px';
        horizontal.thumb.style.left = left + 'px';

        var vertical = self.state.vertical;
        var maxHeight = vertical.track.offsetHeight - MAGIC_NUMBER;
        var height = (scroller.offsetHeight / scroller.scrollHeight) * maxHeight;
        if (height > maxHeight) height = maxHeight;
        var top = (maxHeight - height) * scroller.scrollTop / (scroller.scrollHeight - scroller.offsetHeight);
        vertical.thumb.style.height = (height - MAGIC_NUMBER) + 'px';
        vertical.thumb.style.top = top + 'px';
      }
      
      function toggleScrollBarVisibility() {
        var scroller = self.state.scroller;
        var wrapper = self.state.wrapper;

        requestAnimationFrame(function() {
          var shouldShowHorizontal = scroller.scrollWidth > scroller.offsetWidth;
          var shouldShowVertical = scroller.scrollHeight > scroller.offsetHeight;
          
          if (wrapper.classList.contains('horizontal') != shouldShowHorizontal) {
            wrapper.classList.toggle('horizontal');
          }
          if (wrapper.classList.contains('vertical') != shouldShowVertical) {
            wrapper.classList.toggle('vertical');
          }
        
          updateScrollThumbs();
        });
      }

      self.state = init();
      toggleScrollBarVisibility();
      var lazyToggleScrollBarVisibility = debounce(toggleScrollBarVisibility, 50);

      window.addEventListener('resize', lazyToggleScrollBarVisibility);
      self.state.scroller.addEventListener('scroll', updateScrollThumbs);

      var topContent = document.querySelector('.top-content');
      var leftContent = document.querySelector('.left-content');
      self.state.scroller.addEventListener('scroll', function(){
        topContent.style.transform = 'translate3d(-' + self.state.scroller.scrollLeft + 'px, 0, 0)';
        leftContent.style.transform = 'translate3d(0, -' + self.state.scroller.scrollTop + 'px, 0)';
      });
      
    }
    
    for (let el of document.querySelectorAll('.large-motherfucker')) {
      scrollify(el);
    }

  </script>
</body>
</html>
  